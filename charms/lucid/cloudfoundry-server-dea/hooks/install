#!/bin/bash

set -ux

############################################################################################################
# Set the language
############################################################################################################
LANG=en_US.UTF-8


############################################################################################################
# Dependency and utility packages
############################################################################################################
apt-add-repository ppa:facter-plugins/ppa
apt-get update
DEBIAN_FRONTEND=noninteractive apt-get -y install debconf-utils python-software-properties pwgen facter facter-customfacts-plugin curl


############################################################################################################
# Global variables
############################################################################################################

############################################################################################################
# Add repositories
############################################################################################################
apt-add-repository ppa:cloudfoundry/ppa
apt-get -y update


############################################################################################################
# Preseed variables
############################################################################################################
# DEA
echo debconf cloudfoundry-server-dea/ip string 127.0.0.1 | /usr/bin/debconf-set-selections

############################################################################################################
# Install CloudFoundry DEA package
############################################################################################################
DEBIAN_FRONTEND=noninteractive apt-get -y install cloudfoundry-server-dea


############################################################################################################
# Stop CloudFoundry 
############################################################################################################
service cloudfoundry-server-dea stop


############################################################################################################
# Open the necessary firewall/ACL ports
############################################################################################################
if [ -x /usr/bin/open-port ]; then
   open-port 80/TCP
   open-port 443/TCP
fi

exit 0
